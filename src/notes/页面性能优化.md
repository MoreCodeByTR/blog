# 页面性能优化
>编辑日期：2022.4.1
>
>参考文献：https://juejin.cn/post/6941278592215515143#heading-1
----------
## 1. CDN
content delivery network，内容分发网络，通过互联技术将最靠近用户的服务器向用户响应请求资源，提高传输速度，降低成本；

CDN作为一种基础的云服务，同样具有资源托管、按需扩展（能够应对流量高峰）等方面的优势。

>组成
- 分发服务系统

基本工作单元为cache设备，负责直接响应最终用户的需求，同时负责同步更新源站点的资源。
- 负载均衡系统

负责对所有发起服务请求的用户进行调度；
- 运营管理系统

负责处理业务层面的与外界系统交互所必须的收集、整理、交付工作

> 作用
- 性能方面：用户响应速度提高，降低服务器负载
- 安全方面：有助于防御DDOS（分布式拒绝服务攻击），监控分析异常流量，限制其访问频率；针对MIMS（Man-in-the-MiddleAttack，中间人攻击)，使用全链路 HTTPS 通信

> 原理

与DNS过程密不可分

利用CDN专用DNS服务器在中间进行URl响应
![CDN响应过程](https://raw.githubusercontent.com/MoreCodeByTR/static-resources/master/imgs/HTTP/cdn.png)

> 使用场景
- 前端静态资源缓存
- 直播流媒体推送，直播流媒体不会像静态资源逐层寻找，而是采用主动推送的方式进行；

-------
## 2.懒加载
懒加载也叫做延迟加载、按需加载，指的是在长网页中延迟加载图片数据，是一种较好的网页性能优化的方式。

能够提高网站的首屏加载速度，提升用户的体验，并且可以减少服务器的压力

> 特点
- 减少无用资源加载
- 提升用户体验
- 防止过多图片加载影响其他文件加载

> 图片懒加载实现原理

利用元素的data-xxx自定义属性存储真正的图片src，当图片处于窗口可视位置时，使用js取出属性值赋给src进行加载；

> 懒加载与预加载的区别
- 懒加载是延迟或者不加载，在用户需要的时候再进行访问；
- 预加载是将可能需要访问的资源提前缓存再本地，待需要的时候直接从缓存获取响应；

-----
## 3. 使用webpack进行前端优化
- `压缩代码`：删除多余的代码、注释、简化代码的写法等等⽅式。可以利⽤webpack的 UglifyJsPlugin 和 ParallelUglifyPlugin 来压缩JS⽂件， 利⽤ cssnano （css-loader?minimize）来压缩css
- `利⽤CDN加速`: 在构建过程中，将引⽤的静态资源路径修改为CDN上对应的路径。可以利⽤webpack对于 output 参数和各loader的 publicPath 参数来修改资源路径
- `Tree Shaking`: 将代码中永远不会⾛到的⽚段删除掉。可以通过在启动webpack时追加参数 --optimize-minimize 来实现
- `Code Splitting`: 将代码按路由维度或者组件分块(chunk),这样做到按需加载,同时可以充分利⽤浏览器缓存
- `提取公共第三⽅库`: SplitChunksPlugin插件来进⾏公共模块抽取,利⽤浏览器缓存可以⻓期缓存这些⽆需频繁变动的公共代码


> 如何提高webpack的构建速度
- 多⼊⼝情况下，使⽤ CommonsChunkPlugin 来提取公共代码
- 通过 externals 配置来提取常⽤库
- 利⽤ DllPlugin 和 DllReferencePlugin 预编译资源模块 通过 DllPlugin 来对那些我们引⽤但是绝对不会修改的npm包来进⾏预编译，再通过 DllReferencePlugin 将预编译的模块加载进来。
- 使⽤ Happypack 实现多线程加速编译
- 使⽤ webpack-uglify-parallel 来提升 uglifyPlugin 的压缩速度。 原理上 webpack-uglify-parallel 采⽤了多核并⾏压缩来提升压缩速度
- 使⽤ Tree-shaking 和 Scope Hoisting 来剔除多余代码

----
## 4.垃圾回收
JavaScript代码运行时，需要分配内存空间来储存变量和值。当变量不在参与运行时，就需要系统收回被占用的内存空间，这就是垃圾回收。

>垃圾回收方法

标记清除，引用计数

>减少垃圾回收
- `对数组进行优化`： 在清空一个数组时，最简单的方法就是给其赋值为[ ]，但是与此同时会创建一个新的空对象，可以将数组的长度设置为0，以此来达到清空数组的目的。
- `对object进行优化`： 对象尽量复用，对于不再使用的对象，就将其设置为null，尽快被回收。
- `对函数进行优化`： 在循环中的函数表达式，如果可以复用，尽量放在函数的外面。


>可能引起内存泄漏的方式
- `意外的全局变量`： 由于使用未声明的变量，而意外的创建了一个全局变量，而使这个变量一直留在内存中无法被回收。
- `被遗忘的计时器或回调函数`： 设置了 setInterval 定时器，而忘记取消它，如果循环函数有对外部变量的引用的话，那么这个变量会被一直留在内存中，而无法被回收。
- `脱离 DOM 的引用`： 获取一个 DOM 元素的引用，而后面这个元素被删除，由于一直保留了对这个元素的引用，所以它也无法被回收。
- `闭包`：`不合理的使用闭包`，从而导致某些变量一直被留在内存当中。




